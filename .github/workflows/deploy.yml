name: DEPLOY

on:
  push:
    branches: [ "master" ]

jobs:

  build:

    runs-on: ubuntu-latest
    env:
        VERSION: latest

    steps:
    # - name: Pull images
    #   uses: appleboy/ssh-action@v1.0.3
    #   with:
    #     host: ${{ secrets.HOST }}
    #     username: ${{ secrets.SSH_USER }}
    #     key: ${{ secrets.SSH_KEY }}
    #     script: |
    #       docker pull ghcr.io/vicpril/bomberman-sockets:latest
    #       docker pull ghcr.io/vicpril/bomberman-frontend:latest
    #       docker pull ghcr.io/vicpril/bomberman-api:latest
    #       docker pull ghcr.io/vicpril/bomberman-json:latest
    #       docker pull ghcr.io/vicpril/bomberman-nginx:latest
    #       docker image list
    
    - name: 'Create env file'
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.SSH_USER }}
        key: ${{ secrets.SSH_KEY }}
        script: |
          cd /var/local/
          sudo rm -f .env
          sudo touch .env
          sudo echo CLIENT_URL=${{ vars.CLIENT_URL }} >> .env
          sudo echo API_URL=${{ vars.API_URL }} >> .env
          sudo echo API_JSON_URL=${{ vars.API_JSON_URL }} >> .env
          sudo echo DATABASE_URL=${{ vars.DATABASE_URL }} >> .env
          sudo echo POSTGRES_USER=${{ vars.POSTGRES_USER }} >> .env
          sudo echo POSTGRES_PASSWORD=${{ secrets.POSTGRES_PASSWORD }} >> .env
          sudo echo POSTGRES_DB=${{ vars.POSTGRES_DB }} >> .env
          sudo echo POSTGRES_HOST=${{ vars.POSTGRES_HOST }} >> .env
          sudo echo POSTGRES_PORT=${{ vars.POSTGRES_PORT }} >> .env
          sudo echo PGADMIN_DEFAULT_EMAIL=${{ vars.PGADMIN_DEFAULT_EMAIL }} >> .env
          sudo echo PGADMIN_DEFAULT_PASSWORD=${{ secrets.PGADMIN_DEFAULT_PASSWORD }} >> .env
          sudo echo CLIENT_URL=${{ vars.CLIENT_URL }} >> .env
          sudo echo API_URL=${{ vars.API_URL }} >> .env
          sudo echo API_JSON_URL=${{ vars.API_JSON_URL }} >> .env
          sudo echo SOCKETS_URL=${{ vars.SOCKETS_URL }} >> .env
          sudo echo SOCKETS_PATH=${{ vars.SOCKETS_PATH }} >> .env
          cat .env
    
    # - name: Reload remote components
    #   uses: appleboy/ssh-action@v1.0.3
    #   env:
    #     INPUT_CLIENT_URL: ${{ vars.CLIENT_URL }}
    #   with:
    #     host: ${{ secrets.HOST }}
    #     username: ${{ secrets.SSH_USER }}
    #     key: ${{ secrets.SSH_KEY }}
    #     allenvs: true
    #     script: |
    #       echo "I am $INPUT_CLIENT_URL"
